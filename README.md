# Utility Metering System (UMS) / Автоматизированная Система Контроля и Учёта Энергоресурсов (АСКУЭ)

## Доменные сущности

### Счётчик (Meter)

### Квартира (Flat)


## TODO

- ~~собирать и хранить данные для экспорта в Prometheus~~
- ~~получать количество счётчиков с каждого регистратора~~
- ~~конвертировать 16-ричные показатели в человеческие~~
- ~~создать структуру под показания приборов вместо мапы~~
- ~~разобраться с таймаутами TCP~~
- переспрашивать данные по прибору, если был ~~таймаут~~ unexpected EOF (после прохода по кругу, типа очереди обработки с лимитом 3)
- проверить, откуда "unexpected EOF", если WinCfg делает то же самое
- реализовать поиск устройств (Discovery)
- не инстанцировать (singleton) список регистраторов при каждом обращении к репозиторию регистраторов (static)
- онлайн вставка записей по счётчику в структуру (по мьютексу, но в горутине, чтобы не тормозить опрос)
- выводить время в логи
- выводить в логи контекст (регистратор, с которым идёт работа)
- собирать метрики по общему количеству счётчиков на регистраторе и количеству активных из них
~~- собирать метрику времени работы опроса каждого из регистраторов, чтобы подобрать нужный scrape-период~~
- веб-интерфейс мгновенного опроса счётчика (для монтажника, который будет восстанавливать связь со счётчиками)
- добавить время последнего опроса в метрики счётчика и регистратора
- добавить БД погрешности показаний воды, относительно собранных теплосчётчиком
